<!DOCTYPE html>




<html lang="en">
  <head>
    <meta charset="utf-8" />
    
    <title>Primitives &mdash; Poppy project 1.1.0 documentation</title>
    <meta name="description" content="">
    <meta name="author" content="">

    

<link rel="stylesheet" href="../../_static/css/basicstrap-base.css" type="text/css" />
<link rel="stylesheet" id="current-theme" href="../../_static/css/bootstrap3/bootstrap.min.css" type="text/css" />
<link rel="stylesheet" id="current-adjust-theme" type="text/css" />

<link rel="stylesheet" href="../../_static/css/font-awesome.min.css">

<style type="text/css">
  body {
    padding-top: 60px;
    padding-bottom: 40px;
  }
</style>

<link rel="stylesheet" href="../../_static/css/basicstrap.css" type="text/css" />
<link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
<script type="text/javascript">
  var DOCUMENTATION_OPTIONS = {
            URL_ROOT:    '../../',
            VERSION:     '1.1.0',
            COLLAPSE_INDEX: false,
            FILE_SUFFIX: '.html',
            HAS_SOURCE:  true
  };
</script>
    <script type="text/javascript" src="../../_static/js/jquery.min.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/js/bootstrap3.min.js"></script>
<script type="text/javascript" src="../../_static/js/jquery.cookie.min.js"></script>
<script type="text/javascript" src="../../_static/js/basicstrap.js"></script>
<script type="text/javascript">
</script>
    <link rel="shortcut icon" href="../../_static/poppy_flower_logo-small.png"/>
    <link rel="top" title="Poppy project 1.1.0 documentation" href="../../index.html" />
    <link rel="up" title="Introduction" href="index.html" />
    <link rel="next" title="Using a simulated robot with V-REP" href="vrep.html" />
    <link rel="prev" title="The Motor object" href="motor.html" /> 
  </head>
  <body role="document">
    <div id="navbar-top" class="navbar navbar-fixed-top navbar-default" role="navigation" aria-label="top navigation">
      <div class="container-fluid">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="../../index.html">Poppy project 1.1.0 documentation</a>
        </div>
        <div class="navbar-collapse collapse">
          <ul class="nav navbar-nav navbar-right">
              <li class="dropdown visible-xs">
                <a role="button" id="localToc" data-toggle="dropdown" data-target="#" href="#">Table Of Contents <b class="caret"></b></a>
                <ul class="dropdown-menu localtoc sp-localtoc" role="menu" aria-labelledby="localToc">
                <ul>
<li><a class="reference internal" href="#">Primitives</a><ul>
<li><a class="reference internal" href="#what-is-a-primitive">What is a &#8220;Primitive&#8221;?</a><ul>
<li><a class="reference internal" href="#primitive-manager">Primitive manager</a></li>
<li><a class="reference internal" href="#default-primitives">Default primitives</a></li>
</ul>
</li>
<li><a class="reference internal" href="#writing-your-own-primitive">Writing your own primitive</a><ul>
<li><a class="reference internal" href="#important-instructions">Important instructions</a></li>
<li><a class="reference internal" href="#examples">Examples</a></li>
</ul>
</li>
<li><a class="reference internal" href="#attaching-a-primitive-to-the-robot">Attaching a primitive to the robot</a></li>
</ul>
</li>
</ul>

                </ul>
              </li>

            
              <li><a href="motor.html" title="The Motor object" accesskey="P">previous </a></li>
              <li><a href="vrep.html" title="Using a simulated robot with V-REP" accesskey="N">next </a></li>
              <li><a href="../../py-modindex.html" title="Python Module Index" >modules </a></li>
              <li><a href="../../genindex.html" title="General Index" accesskey="I">index </a></li>
              <li><a href="index.html" accesskey="U">Introduction</a></li>
            
            <li class="visible-xs"><a href="../../_sources/pypot/doc/primitive.txt" rel="nofollow">Show Source</a></li>

            <li class="visible-xs">
                <form class="search form-search form-inline navbar-form navbar-right sp-searchbox" action="../../search.html" method="get">
                  <div class="input-append input-group">
                    <input type="text" class="search-query form-control" name="q" placeholder="Search...">
                    <span class="input-group-btn">
                    <input type="submit" class="btn" value="Go" />
                    </span>
                  </div>
                  <input type="hidden" name="check_keywords" value="yes" />
                  <input type="hidden" name="area" value="default" />
                </form>
            </li>

            

          </ul>

        </div>
      </div>
    </div>
    

    <!-- container -->
    <div class="container-fluid">

      <!-- row -->
      <div class="row">
         
<div class="col-md-3 hidden-xs" id="sidebar-wrapper">
  <div class="sidebar hidden-xs" role="navigation" aria-label="main navigation">
    <p class="logo"><a href="../../index.html">
      <img class="logo" src="../../_static/poppy_name_h144.png" alt="Logo"/>
    </a></p>
  <h3><a href="../../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Primitives</a><ul>
<li><a class="reference internal" href="#what-is-a-primitive">What is a &#8220;Primitive&#8221;?</a><ul>
<li><a class="reference internal" href="#primitive-manager">Primitive manager</a></li>
<li><a class="reference internal" href="#default-primitives">Default primitives</a></li>
</ul>
</li>
<li><a class="reference internal" href="#writing-your-own-primitive">Writing your own primitive</a><ul>
<li><a class="reference internal" href="#important-instructions">Important instructions</a></li>
<li><a class="reference internal" href="#examples">Examples</a></li>
</ul>
</li>
<li><a class="reference internal" href="#attaching-a-primitive-to-the-robot">Attaching a primitive to the robot</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="motor.html"
                        title="previous chapter">The Motor object</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="vrep.html"
                        title="next chapter">Using a simulated robot with V-REP</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../../_sources/pypot/doc/primitive.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" role="search">
  <h3>Quick search</h3>
  <form class="search form-inline" action="../../search.html" method="get">
      <div class="input-append input-group">
        <input type="text" class="search-query form-control" name="q" placeholder="Search...">
        <span class="input-group-btn">
        <input type="submit" class="btn" value="Go" />
        </span>
      </div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
  </div>
</div> 
        

        <div class="col-md-9" id="content-wrapper">
          <div class="document" role="main">
            <div class="documentwrapper">
              <div class="bodywrapper">
                <div class="body">
                  
  <div class="section" id="primitives">
<span id="id1"></span><h1>Primitives<a class="headerlink" href="#primitives" title="Permalink to this headline">¶</a></h1>
<p>In the previous sections, we have shown how to make a simple behavior thanks to the <a class="reference internal" href="pypot.robot.html#pypot.robot.robot.Robot" title="pypot.robot.robot.Robot"><code class="xref py py-class docutils literal"><span class="pre">Robot</span></code></a> abstraction.
<a class="reference internal" href="pypot.primitive.html#pypot.primitive.primitive.Primitive" title="pypot.primitive.primitive.Primitive"><code class="xref py py-class docutils literal"><span class="pre">Primitive</span></code></a> allows you to create more complexe, parallelized behavior really easily.</p>
<div class="section" id="what-is-a-primitive">
<h2>What is a &#8220;Primitive&#8221;?<a class="headerlink" href="#what-is-a-primitive" title="Permalink to this headline">¶</a></h2>
<p>We call <a class="reference internal" href="pypot.primitive.html#pypot.primitive.primitive.Primitive" title="pypot.primitive.primitive.Primitive"><code class="xref py py-class docutils literal"><span class="pre">Primitive</span></code></a> any simple or complex behavior applied to a <a class="reference internal" href="pypot.robot.html#pypot.robot.robot.Robot" title="pypot.robot.robot.Robot"><code class="xref py py-class docutils literal"><span class="pre">Robot</span></code></a>. A primitive can access all sensors and effectors in the robot. It is started in a thread and can therefore run in parallel with other primitives.</p>
<p>All primitives implement the <a class="reference internal" href="pypot.primitive.html#pypot.primitive.primitive.Primitive.start" title="pypot.primitive.primitive.Primitive.start"><code class="xref py py-meth docutils literal"><span class="pre">start()</span></code></a>, <a class="reference internal" href="pypot.primitive.html#pypot.primitive.primitive.Primitive.stop" title="pypot.primitive.primitive.Primitive.stop"><code class="xref py py-meth docutils literal"><span class="pre">stop()</span></code></a>, <a class="reference internal" href="pypot.utils.html#pypot.utils.stoppablethread.StoppableThread.pause" title="pypot.utils.stoppablethread.StoppableThread.pause"><code class="xref py py-meth docutils literal"><span class="pre">pause()</span></code></a> and
<a class="reference internal" href="pypot.utils.html#pypot.utils.stoppablethread.StoppableThread.resume" title="pypot.utils.stoppablethread.StoppableThread.resume"><code class="xref py py-meth docutils literal"><span class="pre">resume()</span></code></a>. Unlike regular python thread, primitive can be restart by calling again the <a class="reference internal" href="pypot.primitive.html#pypot.primitive.primitive.Primitive.start" title="pypot.primitive.primitive.Primitive.start"><code class="xref py py-meth docutils literal"><span class="pre">start()</span></code></a> method.</p>
<p>To check if a primitive is finished, use the <a class="reference internal" href="pypot.primitive.html#pypot.primitive.primitive.Primitive.is_alive" title="pypot.primitive.primitive.Primitive.is_alive"><code class="xref py py-meth docutils literal"><span class="pre">is_alive()</span></code></a> method (will output True if primitive is paused but False if it has been stopped or if it&#8217;s finished). =</p>
<p>The <code class="xref py py-class docutils literal"><span class="pre">PrimitiveLoop</span></code> is a <a class="reference internal" href="pypot.primitive.html#pypot.primitive.primitive.Primitive" title="pypot.primitive.primitive.Primitive"><code class="xref py py-class docutils literal"><span class="pre">Primitive</span></code></a> that repeats its behavior forever.</p>
<p>A primitive is supposed to be independent of other primitives. In particular, a primitive is not aware of the other primitives running on the robot at the same time.</p>
<p>This is really important when you create complex behaviors - such as balance - where many primitives are needed.
Adding another primitive - such as walking - should be direct and not force you to rewrite everything. Furthermore, the balance primitive could also be combined with another behavior - such as shoot a ball - without modifying it.</p>
<div class="section" id="primitive-manager">
<h3>Primitive manager<a class="headerlink" href="#primitive-manager" title="Permalink to this headline">¶</a></h3>
<p>To ensure this independence, the primitive is running in a sort of sandbox. More precisely, this means that the primitive has not direct access to the robot.
It can only request commands (e.g. set a new goal position of a motor) to a <a class="reference internal" href="pypot.primitive.html#pypot.primitive.manager.PrimitiveManager" title="pypot.primitive.manager.PrimitiveManager"><code class="xref py py-class docutils literal"><span class="pre">PrimitiveManager</span></code></a> which transmits them to the &#8220;real&#8221; robot.
As multiple primitives can run on the robot at the same time, their request orders are combined by the manager.</p>
<p>The primitives all share the same manager. In further versions, we would like to move from this linear combination of all primitives to a hierarchical structure and have different layer of managers.</p>
<p>The manager uses a filter function to combine all orders sent by primitives. By default, this filter function is a simple mean but you can choose your own specific filter (e.g. add function).</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">You should not mix control through primitives and direct control through the <a class="reference internal" href="pypot.robot.html#pypot.robot.robot.Robot" title="pypot.robot.robot.Robot"><code class="xref py py-class docutils literal"><span class="pre">Robot</span></code></a>. Indeed, the primitive manager will overwrite your orders at its refresh frequency: i.e. it will look like only the commands send through primitives will be taken into account.</p>
</div>
</div>
<div class="section" id="default-primitives">
<h3>Default primitives<a class="headerlink" href="#default-primitives" title="Permalink to this headline">¶</a></h3>
<p>An example on how to run a primitive is shown <a class="reference internal" href="quickstart-primitive.html#quickstart-primitive"><span>here</span></a>.</p>
<p>Another primitive provided with Pypot is the <a class="reference internal" href="pypot.primitive.html#pypot.primitive.utils.Sinus" title="pypot.primitive.utils.Sinus"><code class="xref py py-class docutils literal"><span class="pre">Sinus</span></code></a> one. It allows you to apply a sinusoidal move of a given frequency and intensity to a motor or a list of motors:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">pypot.primitive.utils</span> <span class="kn">import</span> <span class="n">Sinus</span>

<span class="n">sinus_prim_z</span> <span class="o">=</span> <span class="n">Sinus</span><span class="p">(</span><span class="n">poppy</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="s">&quot;head_z&quot;</span><span class="p">,</span> <span class="n">amp</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">phase</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="c">#set phase to 90° to have the y sinus 1/4 of phase late compared to the z sinus</span>
<span class="n">sinus_prim_y</span> <span class="o">=</span> <span class="n">Sinus</span><span class="p">(</span><span class="n">poppy</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="s">&quot;head_y&quot;</span><span class="p">,</span> <span class="n">amp</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">phase</span><span class="o">=</span><span class="mi">90</span><span class="p">)</span>

<span class="k">print</span> <span class="s">&quot;start moving&quot;</span>
<span class="n">sinus_prim_z</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
<span class="n">sinus_prim_y</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>

<span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>

<span class="k">print</span> <span class="s">&quot;pause move&quot;</span>
<span class="n">sinus_prim_z</span><span class="o">.</span><span class="n">pause</span><span class="p">()</span>
<span class="n">sinus_prim_y</span><span class="o">.</span><span class="n">pause</span><span class="p">()</span>

<span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>

<span class="k">print</span> <span class="s">&quot;restart move&quot;</span>
<span class="n">sinus_prim_z</span><span class="o">.</span><span class="n">resume</span><span class="p">()</span>
<span class="n">sinus_prim_y</span><span class="o">.</span><span class="n">resume</span><span class="p">()</span>

<span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>

<span class="k">print</span> <span class="s">&quot;stop moving&quot;</span>
<span class="n">sinus_prim_z</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
<span class="n">sinus_prim_y</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
</pre></div>
</div>
<p>Other default primitives are:</p>
<ul class="simple">
<li><a class="reference internal" href="pypot.primitive.html#pypot.primitive.utils.Cosinus" title="pypot.primitive.utils.Cosinus"><code class="xref py py-class docutils literal"><span class="pre">Cosinus</span></code></a> for a cosinus move</li>
<li><a class="reference internal" href="pypot.primitive.html#pypot.primitive.utils.Square" title="pypot.primitive.utils.Square"><code class="xref py py-class docutils literal"><span class="pre">Square</span></code></a> for a square (go to max position, wait duty*cycle time, go to minposition, wait (1 - duty)*cycle time)</li>
<li><a class="reference internal" href="pypot.primitive.html#pypot.primitive.utils.PositionWatcher" title="pypot.primitive.utils.PositionWatcher"><code class="xref py py-class docutils literal"><span class="pre">PositionWatcher</span></code></a>: records and saves all positions of the given motors. You have a plot function to see your data.</li>
<li><a class="reference internal" href="pypot.primitive.html#pypot.primitive.utils.SimplePosture" title="pypot.primitive.utils.SimplePosture"><code class="xref py py-class docutils literal"><span class="pre">SimplePosture</span></code></a>: you should define a target_position as a dictionnary and the robot will go to this position</li>
</ul>
</div>
</div>
<div class="section" id="writing-your-own-primitive">
<span id="write-own-prim"></span><h2>Writing your own primitive<a class="headerlink" href="#writing-your-own-primitive" title="Permalink to this headline">¶</a></h2>
<p>To write you own primitive, you have to subclass the <a class="reference internal" href="pypot.primitive.html#pypot.primitive.primitive.Primitive" title="pypot.primitive.primitive.Primitive"><code class="xref py py-class docutils literal"><span class="pre">Primitive</span></code></a> class.
It provides you with basic mechanisms (e.g. connection to the manager, setup of the thread) to allow you to directly &#8220;plug&#8221; your primitive to your robot and run it.</p>
<div class="section" id="important-instructions">
<h3>Important instructions<a class="headerlink" href="#important-instructions" title="Permalink to this headline">¶</a></h3>
<p>When writing your own primitive, you should always keep in mind that you should never directly pass the robot or its motors as argument and access them directly. You have to access them through the self.robot and self.robot.motors properties.</p>
<p>Indeed, at instantiation the <a class="reference internal" href="pypot.robot.html#pypot.robot.robot.Robot" title="pypot.robot.robot.Robot"><code class="xref py py-class docutils literal"><span class="pre">Robot</span></code></a> (resp. <a class="reference internal" href="pypot.dynamixel.html#pypot.dynamixel.motor.DxlMotor" title="pypot.dynamixel.motor.DxlMotor"><code class="xref py py-class docutils literal"><span class="pre">DxlMotor</span></code></a>) instance is transformed into a <a class="reference internal" href="pypot.primitive.html#pypot.primitive.primitive.MockupRobot" title="pypot.primitive.primitive.MockupRobot"><code class="xref py py-class docutils literal"><span class="pre">MockupRobot</span></code></a> (resp. <a class="reference internal" href="pypot.primitive.html#pypot.primitive.primitive.MockupMotor" title="pypot.primitive.primitive.MockupMotor"><code class="xref py py-class docutils literal"><span class="pre">MockupMotor</span></code></a>). Those class are used to intercept the orders sent and forward them to the <a class="reference internal" href="pypot.primitive.html#pypot.primitive.manager.PrimitiveManager" title="pypot.primitive.manager.PrimitiveManager"><code class="xref py py-class docutils literal"><span class="pre">PrimitiveManager</span></code></a> which will combine them. By directly accessing the &#8220;real&#8221; motor or robot you circumvent this mechanism and break the sandboxing.</p>
<p>If you have to specify a list of motors to your primitive (e.g. apply the sinusoid primitive to the specified motors), you should either give the motors name and access the motors within the primitive or transform the list of <a class="reference internal" href="pypot.dynamixel.html#pypot.dynamixel.motor.DxlMotor" title="pypot.dynamixel.motor.DxlMotor"><code class="xref py py-class docutils literal"><span class="pre">DxlMotor</span></code></a> into <a class="reference internal" href="pypot.primitive.html#pypot.primitive.primitive.MockupMotor" title="pypot.primitive.primitive.MockupMotor"><code class="xref py py-class docutils literal"><span class="pre">MockupMotor</span></code></a> thanks to the <a class="reference internal" href="pypot.primitive.html#pypot.primitive.primitive.Primitive.get_mockup_motor" title="pypot.primitive.primitive.Primitive.get_mockup_motor"><code class="xref py py-meth docutils literal"><span class="pre">get_mockup_motor()</span></code></a> method.
For instance:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">MyDummyPrimitive</span><span class="p">(</span><span class="n">pypot</span><span class="o">.</span><span class="n">primitive</span><span class="o">.</span><span class="n">Primitive</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">motors_name</span><span class="p">):</span>
        <span class="n">motors</span> <span class="o">=</span> <span class="p">[</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">robot</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">motors_name</span><span class="p">]</span>

        <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">motors</span><span class="p">:</span>
                <span class="o">...</span>
</pre></div>
</div>
<p>or:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">MyDummyPrimitive</span><span class="p">(</span><span class="n">pypot</span><span class="o">.</span><span class="n">primitive</span><span class="o">.</span><span class="n">Primitive</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">motors</span><span class="p">):</span>
        <span class="n">fake_motors</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">get_mockup_motor</span><span class="p">(</span><span class="n">m</span><span class="p">)</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">motors</span><span class="p">]</span>

        <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">fake_motors</span><span class="p">:</span>
                <span class="o">...</span>
</pre></div>
</div>
<p>When overriding the <a class="reference internal" href="pypot.primitive.html#pypot.primitive.primitive.Primitive" title="pypot.primitive.primitive.Primitive"><code class="xref py py-class docutils literal"><span class="pre">Primitive</span></code></a>, you are responsible for correctly handling those events.
For instance, the stop method will only trigger the should stop event that you should watch in your run loop and break it when the event is set.
In particular, you should check the <a class="reference internal" href="pypot.utils.html#pypot.utils.stoppablethread.StoppableThread.should_stop" title="pypot.utils.stoppablethread.StoppableThread.should_stop"><code class="xref py py-meth docutils literal"><span class="pre">should_stop()</span></code></a> and <a class="reference internal" href="pypot.utils.html#pypot.utils.stoppablethread.StoppableThread.should_pause" title="pypot.utils.stoppablethread.StoppableThread.should_pause"><code class="xref py py-meth docutils literal"><span class="pre">should_pause()</span></code></a> in your run loop.
You can also use the <a class="reference internal" href="pypot.utils.html#pypot.utils.stoppablethread.StoppableThread.wait_to_stop" title="pypot.utils.stoppablethread.StoppableThread.wait_to_stop"><code class="xref py py-meth docutils literal"><span class="pre">wait_to_stop()</span></code></a> and <a class="reference internal" href="pypot.utils.html#pypot.utils.stoppablethread.StoppableThread.wait_to_resume" title="pypot.utils.stoppablethread.StoppableThread.wait_to_resume"><code class="xref py py-meth docutils literal"><span class="pre">wait_to_resume()</span></code></a> to wait until the commands have really been executed.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">You can refer to the source code of the <a class="reference internal" href="pypot.primitive.html#pypot.primitive.primitive.LoopPrimitive" title="pypot.primitive.primitive.LoopPrimitive"><code class="xref py py-class docutils literal"><span class="pre">LoopPrimitive</span></code></a> for an example of how to correctly handle all these events.</p>
</div>
</div>
<div class="section" id="examples">
<h3>Examples<a class="headerlink" href="#examples" title="Permalink to this headline">¶</a></h3>
<p>As an example, let&#8217;s write a simple primitive that recreate the dance behavior written in the <a class="reference internal" href="quickstart.html#dance"><span>Controlling your Ergo-Robot</span></a> section.
Notice that to pass arguments to your primitive, you have to override the <code class="xref py py-meth docutils literal"><span class="pre">__init__()</span></code> method.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">You should always call the super constructor if you override the <code class="xref py py-meth docutils literal"><span class="pre">__init__()</span></code> method.</p>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">time</span>

<span class="kn">import</span> <span class="nn">pypot.primitive</span>
<span class="k">class</span> <span class="nc">DancePrimitive</span><span class="p">(</span><span class="n">pypot</span><span class="o">.</span><span class="n">primitive</span><span class="o">.</span><span class="n">Primitive</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">robot</span><span class="p">,</span> <span class="n">amp</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="mf">0.5</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">robot</span> <span class="o">=</span> <span class="n">robot</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">amp</span> <span class="o">=</span> <span class="n">amp</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">freq</span> <span class="o">=</span> <span class="n">freq</span>
        <span class="n">pypot</span><span class="o">.</span><span class="n">primitive</span><span class="o">.</span><span class="n">Primitive</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">robot</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">amp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">amp</span>
        <span class="n">freq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">freq</span>
        <span class="c"># self.elapsed_time gives you the time (in s) since the primitive has been running</span>
        <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">elapsed_time</span> <span class="o">&lt;</span> <span class="mi">30</span><span class="p">:</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">amp</span> <span class="o">*</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">numpy</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">freq</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">elapsed_time</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">robot</span><span class="o">.</span><span class="n">base_pan</span><span class="o">.</span><span class="n">goal_position</span> <span class="o">=</span> <span class="n">x</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">robot</span><span class="o">.</span><span class="n">head_pan</span><span class="o">.</span><span class="n">goal_position</span> <span class="o">=</span> <span class="o">-</span><span class="n">x</span>

            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.02</span><span class="p">)</span>
</pre></div>
</div>
<p>To run this primitive on your robot, you simply have to do:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">ergo_robot</span> <span class="o">=</span> <span class="n">pypot</span><span class="o">.</span><span class="n">robot</span><span class="o">.</span><span class="n">from_config</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>

<span class="n">dance</span> <span class="o">=</span> <span class="n">DancePrimitive</span><span class="p">(</span><span class="n">ergo_robot</span><span class="p">,</span><span class="n">amp</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>
<span class="n">dance</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
</pre></div>
</div>
<p>If you want to make the dance primitive infinite you can use the <a class="reference internal" href="pypot.primitive.html#pypot.primitive.primitive.LoopPrimitive" title="pypot.primitive.primitive.LoopPrimitive"><code class="xref py py-class docutils literal"><span class="pre">LoopPrimitive</span></code></a> class:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">LoopDancePrimitive</span><span class="p">(</span><span class="n">pypot</span><span class="o">.</span><span class="n">primitive</span><span class="o">.</span><span class="n">LoopPrimitive</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">robot</span><span class="p">,</span> <span class="n">refresh_freq</span><span class="p">,</span> <span class="n">amp</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="mf">0.5</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">robot</span> <span class="o">=</span> <span class="n">robot</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">amp</span> <span class="o">=</span> <span class="n">amp</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">freq</span> <span class="o">=</span> <span class="n">freq</span>
        <span class="n">LoopPrimitive</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">robot</span><span class="p">,</span> <span class="n">refresh_freq</span><span class="p">)</span>

    <span class="c"># The update function is automatically called at the frequency given on the constructor</span>
    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">amp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">amp</span>
        <span class="n">freq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">freq</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">amp</span> <span class="o">*</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">numpy</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">freq</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">elapsed_time</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">robot</span><span class="o">.</span><span class="n">base_pan</span><span class="o">.</span><span class="n">goal_position</span> <span class="o">=</span> <span class="n">x</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">robot</span><span class="o">.</span><span class="n">head_pan</span><span class="o">.</span><span class="n">goal_position</span> <span class="o">=</span> <span class="o">-</span><span class="n">x</span>
</pre></div>
</div>
<p>And then run it with:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">ergo_robot</span> <span class="o">=</span> <span class="n">pypot</span><span class="o">.</span><span class="n">robot</span><span class="o">.</span><span class="n">from_config</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>

<span class="n">dance</span> <span class="o">=</span> <span class="n">LoopDancePrimitive</span><span class="p">(</span><span class="n">ergo_robot</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="n">amp</span> <span class="o">=</span> <span class="mi">40</span><span class="p">,</span> <span class="n">freq</span> <span class="o">=</span> <span class="mf">0.3</span><span class="p">)</span>
<span class="c"># The robot will dance until you call dance.stop()</span>
<span class="n">dance</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="attaching-a-primitive-to-the-robot">
<h2>Attaching a primitive to the robot<a class="headerlink" href="#attaching-a-primitive-to-the-robot" title="Permalink to this headline">¶</a></h2>
<p>You can also attach a primitive to the robot (at start up for example) and then use it more easily.</p>
<p>For example with our DancePrimitive:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">ergo_robot</span> <span class="o">=</span> <span class="n">pypot</span><span class="o">.</span><span class="n">robot</span><span class="o">.</span><span class="n">from_config</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>

<span class="n">ergo_robot</span><span class="o">.</span><span class="n">attach_primitive</span><span class="p">(</span><span class="n">DancePrimitive</span><span class="p">(</span><span class="n">ergo_robot</span><span class="p">),</span> <span class="s">&#39;dance&#39;</span><span class="p">)</span>
<span class="n">ergo_robot</span><span class="o">.</span><span class="n">dance</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
</pre></div>
</div>
<p>By attaching a primitive to the robot, you make it accessible from within other primitive:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">SelectorPrimitive</span><span class="p">(</span><span class="n">pypot</span><span class="o">.</span><span class="n">primitive</span><span class="o">.</span><span class="n">Primitive</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">song</span> <span class="o">==</span> <span class="s">&#39;my_favorite_song_to_dance&#39;</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">robot</span><span class="o">.</span><span class="n">dance</span><span class="o">.</span><span class="n">is_alive</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">robot</span><span class="o">.</span><span class="n">dance</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">In this case, instantiating the DancePrimitive within the SelectorPrimitive would be another solution.</p>
</div>
</div>
</div>


                </div>
              </div>
            </div>
          </div>
        </div>
        
        
      </div><!-- /row -->

      <!-- row -->
      <div class="row footer-relbar">
<div id="navbar-related" class=" related navbar navbar-default" role="navigation" aria-label="related navigation">
  <div class="navbar-inner">
    <ul class="nav navbar-nav ">
        <li><a href="../../index.html">Poppy project 1.1.0 documentation</a></li>
    </ul>
<ul class="nav navbar-nav pull-right hidden-xs hidden-sm">
      
        <li><a href="motor.html" title="The Motor object" >previous</a></li>
        <li><a href="vrep.html" title="Using a simulated robot with V-REP" >next</a></li>
        <li><a href="../../py-modindex.html" title="Python Module Index" >modules</a></li>
        <li><a href="../../genindex.html" title="General Index" >index</a></li>
        <li><a href="index.html" >Introduction</a></li>
        <li><a href="#">top</a></li> 
      
    </ul>
  </div>
</div>
      </div><!-- /row -->

      <!-- footer -->
      <footer role="contentinfo">
          &copy; Copyright 2015, INRIA.
        Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.3.1.
      </footer>
      <!-- /footer -->

    </div>
    <!-- /container -->

  </body>
</html>