<!DOCTYPE html>




<html lang="en">
  <head>
    <meta charset="utf-8" />
    
    <title>Primitives &mdash; Poppy project 1.1.0 documentation</title>
    <meta name="description" content="">
    <meta name="author" content="">

    

<link rel="stylesheet" href="../../_static/css/basicstrap-base.css" type="text/css" />
<link rel="stylesheet" id="current-theme" href="../../_static/css/bootstrap3/bootstrap.min.css" type="text/css" />
<link rel="stylesheet" id="current-adjust-theme" type="text/css" />

<link rel="stylesheet" href="../../_static/css/font-awesome.min.css">

<style type="text/css">
  body {
    padding-top: 60px;
    padding-bottom: 40px;
  }
</style>

<link rel="stylesheet" href="../../_static/css/basicstrap.css" type="text/css" />
<link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
<script type="text/javascript">
  var DOCUMENTATION_OPTIONS = {
            URL_ROOT:    '../../',
            VERSION:     '1.1.0',
            COLLAPSE_INDEX: false,
            FILE_SUFFIX: '.html',
            HAS_SOURCE:  true
  };
</script>
    <script type="text/javascript" src="../../_static/js/jquery.min.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/js/bootstrap3.min.js"></script>
<script type="text/javascript" src="../../_static/js/jquery.cookie.min.js"></script>
<script type="text/javascript" src="../../_static/js/basicstrap.js"></script>
<script type="text/javascript">
</script>
    <link rel="shortcut icon" href="../../_static/poppy_flower_logo-small.png"/>
    <link rel="top" title="Poppy project 1.1.0 documentation" href="../../index.html" />
    <link rel="up" title="Introduction" href="index.html" />
    <link rel="next" title="Using a simulated robot with V-REP" href="vrep.html" />
    <link rel="prev" title="The Motor object" href="motor.html" /> 
  </head>
  <body role="document">
    <div id="navbar-top" class="navbar navbar-fixed-top navbar-default" role="navigation" aria-label="top navigation">
      <div class="container-fluid">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="../../index.html">Poppy project 1.1.0 documentation</a>
        </div>
        <div class="navbar-collapse collapse">
          <ul class="nav navbar-nav navbar-right">
              <li class="dropdown visible-xs">
                <a role="button" id="localToc" data-toggle="dropdown" data-target="#" href="#">Table Of Contents <b class="caret"></b></a>
                <ul class="dropdown-menu localtoc sp-localtoc" role="menu" aria-labelledby="localToc">
                <ul>
<li><a class="reference internal" href="#">Primitives</a><ul>
<li><a class="reference internal" href="#what-is-a-primitive">What is a &#8220;Primitive&#8221;?</a><ul>
<li><a class="reference internal" href="#primitive-manager">Primitive manager</a></li>
<li><a class="reference internal" href="#default-primitives">Default primitives</a></li>
</ul>
</li>
<li><a class="reference internal" href="#writing-your-own-primitive">Writing your own primitive</a><ul>
<li><a class="reference internal" href="#important-instructions">Important instructions</a></li>
<li><a class="reference internal" href="#examples">Examples</a></li>
</ul>
</li>
<li><a class="reference internal" href="#attaching-a-primitive-to-the-robot">Attaching a primitive to the robot</a></li>
</ul>
</li>
</ul>

                </ul>
              </li>

            
              <li><a href="motor.html" title="The Motor object" accesskey="P">previous </a></li>
              <li><a href="vrep.html" title="Using a simulated robot with V-REP" accesskey="N">next </a></li>
              <li><a href="../../py-modindex.html" title="Python Module Index" >modules </a></li>
              <li><a href="../../genindex.html" title="General Index" accesskey="I">index </a></li>
              <li><a href="../../development_guides/index.html" >Development Guides</a></li>
              <li><a href="index.html" accesskey="U">Introduction</a></li>
            
            <li class="visible-xs"><a href="../../_sources/pypot/doc/primitive.txt" rel="nofollow">Show Source</a></li>

            <li class="visible-xs">
                <form class="search form-search form-inline navbar-form navbar-right sp-searchbox" action="../../search.html" method="get">
                  <div class="input-append input-group">
                    <input type="text" class="search-query form-control" name="q" placeholder="Search...">
                    <span class="input-group-btn">
                    <input type="submit" class="btn" value="Go" />
                    </span>
                  </div>
                  <input type="hidden" name="check_keywords" value="yes" />
                  <input type="hidden" name="area" value="default" />
                </form>
            </li>

            

          </ul>

        </div>
      </div>
    </div>
    

    <!-- container -->
    <div class="container-fluid">

      <!-- row -->
      <div class="row">
         
<div class="col-md-3 hidden-xs" id="sidebar-wrapper">
  <div class="sidebar hidden-xs" role="navigation" aria-label="main navigation">
    <p class="logo"><a href="../../index.html">
      <img class="logo" src="../../_static/poppy_name.pdf" alt="Logo"/>
    </a></p>
  <h3><a href="../../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Primitives</a><ul>
<li><a class="reference internal" href="#what-is-a-primitive">What is a &#8220;Primitive&#8221;?</a><ul>
<li><a class="reference internal" href="#primitive-manager">Primitive manager</a></li>
<li><a class="reference internal" href="#default-primitives">Default primitives</a></li>
</ul>
</li>
<li><a class="reference internal" href="#writing-your-own-primitive">Writing your own primitive</a><ul>
<li><a class="reference internal" href="#important-instructions">Important instructions</a></li>
<li><a class="reference internal" href="#examples">Examples</a></li>
</ul>
</li>
<li><a class="reference internal" href="#attaching-a-primitive-to-the-robot">Attaching a primitive to the robot</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="motor.html"
                        title="previous chapter">The Motor object</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="vrep.html"
                        title="next chapter">Using a simulated robot with V-REP</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../../_sources/pypot/doc/primitive.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" role="search">
  <h3>Quick search</h3>
  <form class="search form-inline" action="../../search.html" method="get">
      <div class="input-append input-group">
        <input type="text" class="search-query form-control" name="q" placeholder="Search...">
        <span class="input-group-btn">
        <input type="submit" class="btn" value="Go" />
        </span>
      </div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
  </div>
</div> 
        

        <div class="col-md-9" id="content-wrapper">
          <div class="document" role="main">
            <div class="documentwrapper">
              <div class="bodywrapper">
                <div class="body">
                  
  <div class="section" id="primitives">
<span id="primitives"></span><h1>Primitives<a class="headerlink" href="#primitives" title="Permalink to this headline">¶</a></h1>
<p>In the previous sections, we have shown how to make a simple behavior
thanks to the <a class="reference external" href="pypot.robot.html#pypot.robot.robot.Robot">pypot.robot.robot.Robot</a> abstraction.
<a class="reference external" href="pypot.primitive.html#pypot.primitive.primitive.Primitive">pypot.primitive.primitive.Primitive</a> allows you to create more
complexe, parallelized behavior really easily.</p>
<div class="section" id="what-is-a-primitive">
<span id="what-is-a-primitive"></span><h2>What is a &#8220;Primitive&#8221;?<a class="headerlink" href="#what-is-a-primitive" title="Permalink to this headline">¶</a></h2>
<p>We call <a class="reference external" href="pypot.primitive.html#pypot.primitive.primitive.Primitive">pypot.primitive.primitive.Primitive</a> any simple or complex
behavior applied to a <a class="reference external" href="pypot.robot.html#pypot.robot.robot.Robot">pypot.robot.robot.Robot</a>. A primitive can access
all sensors and effectors in the robot. It is started in a thread and
can therefore run in parallel with other primitives.</p>
<p>All primitives implement the
<a class="reference external" href="pypot.primitive.html#pypot.primitive.primitive.Primitive">pypot.primitive.primitive.Primitive.start</a>,
<a class="reference external" href="pypot.primitive.html#pypot.primitive.primitive.Primitive">pypot.primitive.primitive.Primitive.stop</a>,
<a class="reference external" href="pypot.utils.html#pypot.utils.stoppablethread.StoppableThread">pypot.utils.stoppablethread.StoppableThread.pause</a> and
<a class="reference external" href="pypot.utils.html#pypot.utils.stoppablethread.StoppableThread">pypot.utils.stoppablethread.StoppableThread.resume</a>. Unlike regular
python thread, primitive can be restart by calling again the
<a class="reference external" href="pypot.primitive.html#pypot.primitive.primitive.Primitive">pypot.primitive.primitive.Primitive.start</a> method.</p>
<p>To check if a primitive is finished, use the
<a class="reference external" href="pypot.primitive.html#pypot.primitive.primitive.Primitive">pypot.primitive.primitive.Primitive.start.is_alive</a> method (will output True
if primitive is paused but False if it has been stopped or if it&#8217;s finished).</p>
<p>The <a class="reference external" href="pypot.primitive.html#pypot.primitive.primitive.PrimitiveLoop">pypot.primitive.primitive.PrimitiveLoop</a> is a
<a class="reference external" href="pypot.primitive.html#pypot.primitive.primitive.Primitive">pypot.primitive.primitive.Primitive</a> that repeats its behavior forever.</p>
<p>A primitive is supposed to be independent of other primitives. In
particular, a primitive is not aware of the other primitives running on
the robot at the same time.</p>
<p>This is really important when you create complex behaviors - such as
balance - where many primitives are needed. Adding another primitive -
such as walking - should be direct and not force you to rewrite
everything. Furthermore, the balance primitive could also be combined
with another behavior - such as shoot a ball - without modifying it.</p>
<div class="section" id="primitive-manager">
<span id="primitive-manager"></span><h3>Primitive manager<a class="headerlink" href="#primitive-manager" title="Permalink to this headline">¶</a></h3>
<p>To ensure this independence, the primitive is running in a sort of
sandbox. More precisely, this means that the primitive has not direct
access to the robot. It can only request commands (e.g. set a new goal
position of a motor) to a <a class="reference external" href="pypot.primitive.html#pypot.primitive.manager.PrimitiveManager">pypot.primitive.manager.PrimitiveManager</a>
which transmits them to the &#8220;real&#8221; robot. As multiple primitives can run
on the robot at the same time, their request orders are combined by the
manager.</p>
<p>The primitives all share the same manager. In further versions, we would
like to move from this linear combination of all primitives to a
hierarchical structure and have different layer of managers.</p>
<p>The manager uses a filter function to combine all orders sent by
primitives. By default, this filter function is a simple mean but you
can choose your own specific filter (e.g. add function).</p>
<blockquote>
<div><p><strong>warning</strong></p>
<p>You should not mix control through primitives and direct control
through the <a class="reference external" href="pypot.robot.html#pypot.robot.robot.Robot">pypot.robot.robot.Robot</a>. Indeed, the primitive manager
will overwrite your orders at its refresh frequency: i.e. it will look
like only the commands send through primitives will be taken into
account.</p>
</div></blockquote>
</div>
<div class="section" id="default-primitives">
<span id="default-primitives"></span><h3>Default primitives<a class="headerlink" href="#default-primitives" title="Permalink to this headline">¶</a></h3>
<p>An example on how to run a primitive is shown
<a class="reference external" href="quickstart-primitive.html">here</a>.</p>
<p>Another primitive provided with Pypot is the
<a class="reference external" href="pypot.primitive.html#pypot.primitive.utils.Sinus">pypot.primitive.utils.Sinus</a> one. It allows you to apply a sinusoidal
move of a given frequency and intensity to a motor or a list of motors:</p>
<pre class="literal-block">
from pypot.primitive.utils import Sinus

sinus_prim_z = Sinus(poppy, 50, &quot;head_z&quot;, amp=30, freq=0.5, offset=0, phase=0)

#set phase to 90° to have the y sinus 1/4 of phase late compared to the z sinus
sinus_prim_y = Sinus(poppy, 50, &quot;head_y&quot;, amp=20, freq=1, offset=0, phase=90)

print &quot;start moving&quot;    
sinus_prim_z.start()
sinus_prim_y.start()

time.sleep(20)

print &quot;pause move&quot; 
sinus_prim_z.pause()
sinus_prim_y.pause()

time.sleep(5)

print &quot;restart move&quot;    
sinus_prim_z.resume()
sinus_prim_y.resume()

time.sleep(20)

print &quot;stop moving&quot; 
sinus_prim_z.stop()
sinus_prim_y.stop()
</pre>
<p>Other default primitives are:</p>
<ul class="simple">
<li><a class="reference external" href="pypot.primitive.html#pypot.primitive.utils.Cosinus">pypot.primitive.utils.Cosinus</a> for a cosinus move</li>
<li><a class="reference external" href="pypot.primitive.html#pypot.primitive.utils.Square">pypot.primitive.utils.Square</a> for a square (go to max position,
wait duty*cycle time, go to minposition, wait (1 - duty)*cycle
time)</li>
<li><a class="reference external" href="pypot.primitive.html#pypot.primitive.utils.PositionWatcher">pypot.primitive.utils.PositionWatcher</a>: records and saves all
positions of the given motors. You have a plot function to see your
data.</li>
<li><a class="reference external" href="pypot.primitive.html#pypot.primitive.utils.SimplePosture">pypot.primitive.utils.SimplePosture</a>: you should define a
target_position as a dictionnary and the robot will go to this
position</li>
</ul>
</div>
</div>
<div class="section" id="writing-your-own-primitive">
<span id="writing-your-own-primitive"></span><h2>Writing your own primitive<a class="headerlink" href="#writing-your-own-primitive" title="Permalink to this headline">¶</a></h2>
<p>To write you own primitive, you have to subclass the
<a class="reference external" href="pypot.primitive.html#pypot.primitive.primitive.Primitive">pypot.primitive.primitive.Primitive</a> class. It provides you with basic
mechanisms (e.g. connection to the manager, setup of the thread) to
allow you to directly &#8220;plug&#8221; your primitive to your robot and run it.</p>
<div class="section" id="important-instructions">
<span id="important-instructions"></span><h3>Important instructions<a class="headerlink" href="#important-instructions" title="Permalink to this headline">¶</a></h3>
<p>When writing your own primitive, you should always keep in mind that you
should never directly pass the robot or its motors as argument and
access them directly. You have to access them through the self.robot and
self.robot.motors properties.</p>
<p>Indeed, at instantiation the <a class="reference external" href="pypot.robot.html#pypot.robot.robot.Robot">pypot.robot.robot.Robot</a> (resp.
<a class="reference external" href="pypot.dynamixel.html#pypot.dynamixel.motor.DxlMotor">pypot.dynamixel.motor.DxlMotor</a>) instance is transformed into a
<a class="reference external" href="pypot.primitive.html#pypot.primitive.primitive.MockupRobot">pypot.primitive.primitive.MockupRobot</a> (resp.
<a class="reference external" href="pypot.primitive.html#pypot.primitive.primitive.MockupMotor">pypot.primitive.primitive.MockupMotor</a>). Those class are used to
intercept the orders sent and forward them to the
<a class="reference external" href="pypot.primitive.html#pypot.primitive.manager.PrimitiveManager">pypot.primitive.manager.PrimitiveManager</a> which will combine them. By
directly accessing the &#8220;real&#8221; motor or robot you circumvent this
mechanism and break the sandboxing.</p>
<p>If you have to specify a list of motors to your primitive (e.g. apply
the sinusoid primitive to the specified motors), you should either give
the motors name and access the motors within the primitive or transform
the list of <a class="reference external" href="pypot.dynamixel.html#pypot.dynamixel.motor.DxlMotor">pypot.dynamixel.motor.DxlMotor</a> into
<a class="reference external" href="pypot.primitive.html#pypot.primitive.primitive.MockupMotor">pypot.primitive.primitive.MockupMotor</a> thanks to the
<a class="reference external" href="pypot.primitive.html#pypot.primitive.primitive.Primitive">pypot.primitive.primitive.Primitive.get_mockup_motor</a> method. For
instance:</p>
<pre class="literal-block">
class MyDummyPrimitive(pypot.primitive.Primitive):
    def run(self, motors_name):
        motors = [getattr(self.robot, name) for name in motors_name]

        while True:
            for m in motors:
                ...
</pre>
<p>or:</p>
<pre class="literal-block">
class MyDummyPrimitive(pypot.primitive.Primitive):
    def run(self, motors):
        fake_motors = [self.get_mockup_motor(m) for m in motors]

        while True:
            for m in fake_motors:
                ...
</pre>
<p>When overriding the <a class="reference external" href="pypot.primitive.html#pypot.primitive.primitive.Primitive">pypot.primitive.primitive.Primitive</a>, you are
responsible for correctly handling those events. For instance, the stop
method will only trigger the should stop event that you should watch in
your run loop and break it when the event is set. In particular, you
should check the
<a class="reference external" href="pypot.utils.html#pypot.utils.stoppablethread.StoppableThread">pypot.utils.stoppablethread.StoppableThread.should_stop</a> and
<a class="reference external" href="pypot.utils.html#pypot.utils.stoppablethread.StoppableThread">pypot.utils.stoppablethread.StoppableThread.should_pause</a>  in your run
loop. You can also use the
<a class="reference external" href="pypot.utils.html#pypot.utils.stoppablethread.StoppableThread">pypot.utils.stoppablethread.StoppableThread.wait_to_stop</a> and
<a class="reference external" href="pypot.utils.html#pypot.utils.stoppablethread.StoppableThread">pypot.utils.stoppablethread.StoppableThread.wait_to_resume</a> to wait
until the commands have really been executed.</p>
<blockquote>
<div><p><strong>note</strong></p>
<p>You can refer to the source code of the
<a class="reference external" href="pypot.primitive.html#pypot.primitive.primitive.LoopPrimitive">pypot.primitive.primitive.LoopPrimitive</a> for an example of how to
correctly handle all these events.</p>
</div></blockquote>
</div>
<div class="section" id="examples">
<span id="examples"></span><h3>Examples<a class="headerlink" href="#examples" title="Permalink to this headline">¶</a></h3>
<p>As an example, let&#8217;s write a simple primitive that recreate the dance
behavior written in the dance_ section. Notice that to pass arguments
to your primitive, you have to override the
<a class="reference external" href="pypot.primitive.html#pypot.primitive.primitive.Primitive">pypot.primitive.primitive.Primitive.__init__</a> method.</p>
<blockquote>
<div><p><strong>note</strong></p>
<p>You should always call the super constructor if you override the
<a class="reference external" href="pypot.primitive.html#pypot.primitive.primitive.Primitive">pypot.primitive.primitive.Primitive.__init__</a> method.</p>
</div></blockquote>
<pre class="literal-block">
import time

import pypot.primitive
class DancePrimitive(pypot.primitive.Primitive):

    def __init__(self, robot, amp=30, freq=0.5):
        self.robot = robot
        self.amp = amp
        self.freq = freq
        pypot.primitive.Primitive.__init__(self, robot)

    def run(self):
        amp = self.amp
        freq = self.freq
        # self.elapsed_time gives you the time (in s) since the primitive has been running
        while self.elapsed_time &lt; 30:
            x = amp * numpy.sin(2 * numpy.pi * freq * self.elapsed_time)

            self.robot.base_pan.goal_position = x
            self.robot.head_pan.goal_position = -x

            time.sleep(0.02)
</pre>
<p>To run this primitive on your robot, you simply have to do:</p>
<pre class="literal-block">
ergo_robot = pypot.robot.from_config(...)

dance = DancePrimitive(ergo_robot,amp=60, freq=0.6)
dance.start()
</pre>
<p>If you want to make the dance primitive infinite you can use the
<a class="reference external" href="pypot.primitive.html#pypot.primitive.primitive.LoopPrimitive">pypot.primitive.primitive.LoopPrimitive</a> class:</p>
<pre class="literal-block">
class LoopDancePrimitive(pypot.primitive.LoopPrimitive):
    def __init__(self, robot, refresh_freq, amp=30, freq=0.5):
        self.robot = robot
        self.amp = amp
        self.freq = freq
        LoopPrimitive.__init__(self, robot, refresh_freq)

    # The update function is automatically called at the frequency given on the constructor
    def update(self):
        amp = self.amp
        freq = self.freq
        x = amp * numpy.sin(2 * numpy.pi * freq * self.elapsed_time)

        self.robot.base_pan.goal_position = x
        self.robot.head_pan.goal_position = -x
</pre>
<p>And then run it with:</p>
<pre class="literal-block">
ergo_robot = pypot.robot.from_config(...)

dance = LoopDancePrimitive(ergo_robot, 50, amp = 40, freq = 0.3)
# The robot will dance until you call dance.stop()
dance.start()
</pre>
</div>
</div>
<div class="section" id="attaching-a-primitive-to-the-robot">
<span id="attaching-a-primitive-to-the-robot"></span><h2>Attaching a primitive to the robot<a class="headerlink" href="#attaching-a-primitive-to-the-robot" title="Permalink to this headline">¶</a></h2>
<p>You can also attach a primitive to the robot (at start up for example)
and then use it more easily.</p>
<p>For example with our DancePrimitive:</p>
<pre class="literal-block">
ergo_robot = pypot.robot.from_config(...)

ergo_robot.attach_primitive(DancePrimitive(ergo_robot), 'dance')
ergo_robot.dance.start()
</pre>
<p>By attaching a primitive to the robot, you make it accessible from
within other primitive:</p>
<pre class="literal-block">
class SelectorPrimitive(pypot.primitive.Primitive):
    def run(self):
        if song == 'my_favorite_song_to_dance' and not self.robot.dance.is_alive():
            self.robot.dance.start()
</pre>
<blockquote>
<div><p><strong>note</strong></p>
<p>In this case, instantiating the DancePrimitive within the
SelectorPrimitive would be another solution.</p>
</div></blockquote>
</div>
</div>


                </div>
              </div>
            </div>
          </div>
        </div>
        
        
      </div><!-- /row -->

      <!-- row -->
      <div class="row footer-relbar">
<div id="navbar-related" class=" related navbar navbar-default" role="navigation" aria-label="related navigation">
  <div class="navbar-inner">
    <ul class="nav navbar-nav ">
        <li><a href="../../index.html">Poppy project 1.1.0 documentation</a></li>
    </ul>
<ul class="nav navbar-nav pull-right hidden-xs hidden-sm">
      
        <li><a href="motor.html" title="The Motor object" >previous</a></li>
        <li><a href="vrep.html" title="Using a simulated robot with V-REP" >next</a></li>
        <li><a href="../../py-modindex.html" title="Python Module Index" >modules</a></li>
        <li><a href="../../genindex.html" title="General Index" >index</a></li>
        <li><a href="../../development_guides/index.html" >Development Guides</a></li>
        <li><a href="index.html" >Introduction</a></li>
        <li><a href="#">top</a></li> 
      
    </ul>
  </div>
</div>
      </div><!-- /row -->

      <!-- footer -->
      <footer role="contentinfo">
          &copy; Copyright 2015, INRIA.
        Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.3.1.
      </footer>
      <!-- /footer -->

    </div>
    <!-- /container -->

  </body>
</html>