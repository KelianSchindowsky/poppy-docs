<!DOCTYPE html>




<html lang="en">
  <head>
    <meta charset="utf-8" />
    
    <title>Extending pypot &mdash; Poppy project 1.1.0 documentation</title>
    <meta name="description" content="">
    <meta name="author" content="">

    

<link rel="stylesheet" href="../../_static/css/basicstrap-base.css" type="text/css" />
<link rel="stylesheet" id="current-theme" href="../../_static/css/bootstrap3/bootstrap.min.css" type="text/css" />
<link rel="stylesheet" id="current-adjust-theme" type="text/css" />

<link rel="stylesheet" href="../../_static/css/font-awesome.min.css">

<style type="text/css">
  body {
    padding-top: 60px;
    padding-bottom: 40px;
  }
</style>

<link rel="stylesheet" href="../../_static/css/basicstrap.css" type="text/css" />
<link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
<script type="text/javascript">
  var DOCUMENTATION_OPTIONS = {
            URL_ROOT:    '../../',
            VERSION:     '1.1.0',
            COLLAPSE_INDEX: false,
            FILE_SUFFIX: '.html',
            HAS_SOURCE:  true
  };
</script>
    <script type="text/javascript" src="../../_static/js/jquery.min.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/js/bootstrap3.min.js"></script>
<script type="text/javascript" src="../../_static/js/jquery.cookie.min.js"></script>
<script type="text/javascript" src="../../_static/js/basicstrap.js"></script>
<script type="text/javascript">
</script>
    <link rel="shortcut icon" href="../../_static/poppy_flower_logo-small.png"/>
    <link rel="top" title="Poppy project 1.1.0 documentation" href="../../index.html" />
    <link rel="up" title="Introduction" href="index.html" />
    <link rel="next" title="QuickStart: discover and communicate with Dynamixel servomotors" href="quickstart-lowlevel.html" />
    <link rel="prev" title="Installation and updating" href="installation.html" /> 
  </head>
  <body role="document">
    <div id="navbar-top" class="navbar navbar-fixed-top navbar-default" role="navigation" aria-label="top navigation">
      <div class="container-fluid">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="../../index.html">Poppy project 1.1.0 documentation</a>
        </div>
        <div class="navbar-collapse collapse">
          <ul class="nav navbar-nav navbar-right">
              <li class="dropdown visible-xs">
                <a role="button" id="localToc" data-toggle="dropdown" data-target="#" href="#">Table Of Contents <b class="caret"></b></a>
                <ul class="dropdown-menu localtoc sp-localtoc" role="menu" aria-labelledby="localToc">
                <ul>
<li><a class="reference internal" href="#">Extending pypot</a><ul>
<li><a class="reference internal" href="#writing-a-new-io">Writing a new IO</a></li>
<li><a class="reference internal" href="#writing-a-new-controller">Writing a new Controller</a></li>
<li><a class="reference internal" href="#integrate-it-into-the-robot">Integrate it into the Robot</a></li>
</ul>
</li>
</ul>

                </ul>
              </li>

            
              <li><a href="installation.html" title="Installation and updating" accesskey="P">previous </a></li>
              <li><a href="quickstart-lowlevel.html" title="QuickStart: discover and communicate with Dynamixel servomotors" accesskey="N">next </a></li>
              <li><a href="../../py-modindex.html" title="Python Module Index" >modules </a></li>
              <li><a href="../../genindex.html" title="General Index" accesskey="I">index </a></li>
              <li><a href="../../development_guides/index.html" >Development Guides</a></li>
              <li><a href="index.html" accesskey="U">Introduction</a></li>
            
            <li class="visible-xs"><a href="../../_sources/pypot/doc/extending.txt" rel="nofollow">Show Source</a></li>

            <li class="visible-xs">
                <form class="search form-search form-inline navbar-form navbar-right sp-searchbox" action="../../search.html" method="get">
                  <div class="input-append input-group">
                    <input type="text" class="search-query form-control" name="q" placeholder="Search...">
                    <span class="input-group-btn">
                    <input type="submit" class="btn" value="Go" />
                    </span>
                  </div>
                  <input type="hidden" name="check_keywords" value="yes" />
                  <input type="hidden" name="area" value="default" />
                </form>
            </li>

            

          </ul>

        </div>
      </div>
    </div>
    

    <!-- container -->
    <div class="container-fluid">

      <!-- row -->
      <div class="row">
         
<div class="col-md-3 hidden-xs" id="sidebar-wrapper">
  <div class="sidebar hidden-xs" role="navigation" aria-label="main navigation">
    <p class="logo"><a href="../../index.html">
      <img class="logo" src="../../_static/poppy_name.pdf" alt="Logo"/>
    </a></p>
  <h3><a href="../../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Extending pypot</a><ul>
<li><a class="reference internal" href="#writing-a-new-io">Writing a new IO</a></li>
<li><a class="reference internal" href="#writing-a-new-controller">Writing a new Controller</a></li>
<li><a class="reference internal" href="#integrate-it-into-the-robot">Integrate it into the Robot</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="installation.html"
                        title="previous chapter">Installation and updating</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="quickstart-lowlevel.html"
                        title="next chapter">QuickStart: discover and communicate with Dynamixel servomotors</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../../_sources/pypot/doc/extending.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" role="search">
  <h3>Quick search</h3>
  <form class="search form-inline" action="../../search.html" method="get">
      <div class="input-append input-group">
        <input type="text" class="search-query form-control" name="q" placeholder="Search...">
        <span class="input-group-btn">
        <input type="submit" class="btn" value="Go" />
        </span>
      </div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
  </div>
</div> 
        

        <div class="col-md-9" id="content-wrapper">
          <div class="document" role="main">
            <div class="documentwrapper">
              <div class="bodywrapper">
                <div class="body">
                  
  <div class="section" id="extending-pypot">
<span id="extending-pypot"></span><h1>Extending pypot<a class="headerlink" href="#extending-pypot" title="Permalink to this headline">¶</a></h1>
<p>While pypot has been originally designed for controlling dynamixel based
robots, it became rapidly obvious that it would be really useful to
easily:</p>
<ul class="simple">
<li>control other types of motor (e.g. servo-motors controlled using
PWM)</li>
<li>control an entire robot composed of different types of motors (using
dynamixel for the legs and smaller servo for the hands for instance)</li>
</ul>
<p>While it was already possible to do such things in pypot, the library
has been partially re-architectured in version 2.x to better reflect
those possibilities and most importantly make it easier for contributors
to add the layer needed for adding support for other types of motors.</p>
<blockquote>
<div><p><strong>note</strong></p>
<p>While in most of this documentation, we will show how support for
other motors can be added, similar methods can be applied to also
support other sensors.</p>
</div></blockquote>
<p>The rest of this section will describe the main concept behing pypot&#8217;s
architecture and then give examples of how to extend it.</p>
<div class="section" id="writing-a-new-io">
<span id="writing-a-new-io"></span><h2>Writing a new IO<a class="headerlink" href="#writing-a-new-io" title="Permalink to this headline">¶</a></h2>
<p>In pypot&#8217;s architecture, the IO aims at providing convenient methods to
access (read/write) value from a device - which could be a motor, a
camera, or a simulator. It is the role of the IO to handle the
communication:</p>
<ul class="simple">
<li>open/close the communication channel,</li>
<li>encapsulate the protocol.</li>
</ul>
<p>For example, the <a class="reference external" href="pypot.dynamixel.io.html#pypot.dynamixel.io.io.DxlIO">pypot.dynamixel.io.io.DxlIO</a> (for dynamixel buses)
open/closes the serial port and provides high-level methods for sending
dynamixel packet - e.g. for getting a motor position. Similarly, writing
the <a class="reference external" href="pypot.vrep.html#pypot.vrep.io.VrepIO">pypot.vrep.io.VrepIO</a> consists in opening the communication socket
to the V-REP simulator (thanks to <a class="reference external" href="http://www.coppeliarobotics.com/helpFiles/en/remoteApiFunctionsPython.htm">V-REP&#8217;s remote API</a>)
and then encapsulating all methods for getting/setting all the simulated
motors registers.</p>
<blockquote>
<div><p><strong>warning</strong></p>
<p>While this is not by any mean mandatory, it is often a good practice
to write all IO access as synchronous calls. The higher-level
synchronization loop is usually written as a
<a class="reference external" href="pypot.robot.html#pypot.robot.controller.AbstractController">pypot.robot.controller.AbstractController</a>.</p>
</div></blockquote>
<p>The IO should also handle the low-level communication errors. For
instance, the <a class="reference external" href="pypot.dynamixel.io.html#pypot.dynamixel.io.io.DxlIO">pypot.dynamixel.io.io.DxlIO</a> automatically handles the
timeout error to prevent the whole communication to stop.</p>
<blockquote>
<div><p><strong>note</strong></p>
<p>Once the new IO is written most of the integration into pypot should
be done! To facilitate the integration of the new IO with the higher
layer, we strongly recommend to take inspiration from the existing IO</p>
<ul class="simple">
<li>especially the <a class="reference external" href="pypot.dynamixel.io.html#pypot.dynamixel.io.io.DxlIO">pypot.dynamixel.io.io.DxlIO</a> and the
<a class="reference external" href="pypot.vrep.html#pypot.vrep.io.VrepIO">pypot.vrep.io.VrepIO</a> ones.</li>
</ul>
</div></blockquote>
</div>
<div class="section" id="writing-a-new-controller">
<span id="writing-a-new-controller"></span><h2>Writing a new Controller<a class="headerlink" href="#writing-a-new-controller" title="Permalink to this headline">¶</a></h2>
<p>A <a class="reference external" href="pypot.robot.html#pypot.robot.controller.AbstractController">pypot.robot.controller</a> is basically a synchronization
loop which role is to keep up to date the state of the device and its
&#8220;software&#8221; equivalent - through the associated IO.</p>
<p>In the case of the <a class="reference external" href="pypot.dynamixel.html#pypot.dynamixel.controller.DxlController">pypot.dynamixel.controller.DxlController</a>, it runs a
50Hz loop which reads the actual position/speed/load of the real motor
and sets it to the associated register in the
<a class="reference external" href="pypot.dynamixel.html#pypot.dynamixel.motor.DxlMotor">pypot.dynamixel.motor.DxlMotor</a>. It also reads the goal
position/speed/load set in the <a class="reference external" href="pypot.dynamixel.html#pypot.dynamixel.motor.DxlMotor">pypot.dynamixel.motor.DxlMotor</a> and
sends them to the &#8220;real&#8221; motor.</p>
<p>As most controller will have the same general structure - i.e. calling a
sync. method at a predefined frequency - pypot provides an abstract
class, the <a class="reference external" href="pypot.robot.html#pypot.robot.controller.AbstractController">pypot.robot.controller.AbstractController</a>, which does
exactly that. If your controller fits within this conception, you should
only have to overide the
<a class="reference external" href="pypot.robot.html#pypot.robot.controller.AbstractController">pypot.robot.controller.AbstractController.update</a> method.</p>
<p>In the case of the <a class="reference external" href="pypot.vrep.html#pypot.vrep.controller.VrepController">pypot.vrep.controller.VrepController</a>, the update
loop simply retrieves each motor&#8217;s present position and send the new
target position. A similar approach is used to retrieve values form
V-REP sensors.</p>
<blockquote>
<div><p><strong>note</strong></p>
<p>Each controller can run at its own pre-defined frequency and live
within its own thread. Thus, the update never blocks the main thread
and you can used tight synchronization loop where they are needed
(e.g. for motor&#8217;s command) and slower one when latency is not a big
issue (e.g. a temperature sensor).</p>
</div></blockquote>
</div>
<div class="section" id="integrate-it-into-the-robot">
<span id="integrate-it-into-the-robot"></span><h2>Integrate it into the Robot<a class="headerlink" href="#integrate-it-into-the-robot" title="Permalink to this headline">¶</a></h2>
<p>Once you have defined your Controller, you most likely want to define a
convenient factory functions (such as <a class="reference external" href="pypot.robot.html#pypot.robot.config.from_config">pypot.robot.config.from_config</a>
or <a class="reference external" href="pypot.vrep.html#pypot.vrep.from_vrep">pypot.vrep.from_vrep</a>) allowing users to easily instantiate their
<a class="reference external" href="pypot.robot.html#pypot.robot.robot.Robot">pypot.robot.robot.Robot</a> with the new Controller.</p>
<p>By doing so you will permit them to seamlessly uses your interface with
this new device without changing the high-level API. For instance, as
both the <a class="reference external" href="pypot.dynamixel.html#pypot.dynamixel.controller.DxlController">pypot.dynamixel.controller.DxlController</a> and the
<a class="reference external" href="pypot.vrep.html#pypot.vrep.controller.VrepController">pypot.vrep.controller.VrepController</a> only interact with the
<a class="reference external" href="pypot.robot.html#pypot.robot.robot.Robot">pypot.robot.robot.Robot</a>  through getting and setting values into
<a class="reference external" href="pypot.robot.html#pypot.robot.motor.Motor">pypot.robot.motor.Motor</a>  instances, they can be directly switch.</p>
</div>
</div>


                </div>
              </div>
            </div>
          </div>
        </div>
        
        
      </div><!-- /row -->

      <!-- row -->
      <div class="row footer-relbar">
<div id="navbar-related" class=" related navbar navbar-default" role="navigation" aria-label="related navigation">
  <div class="navbar-inner">
    <ul class="nav navbar-nav ">
        <li><a href="../../index.html">Poppy project 1.1.0 documentation</a></li>
    </ul>
<ul class="nav navbar-nav pull-right hidden-xs hidden-sm">
      
        <li><a href="installation.html" title="Installation and updating" >previous</a></li>
        <li><a href="quickstart-lowlevel.html" title="QuickStart: discover and communicate with Dynamixel servomotors" >next</a></li>
        <li><a href="../../py-modindex.html" title="Python Module Index" >modules</a></li>
        <li><a href="../../genindex.html" title="General Index" >index</a></li>
        <li><a href="../../development_guides/index.html" >Development Guides</a></li>
        <li><a href="index.html" >Introduction</a></li>
        <li><a href="#">top</a></li> 
      
    </ul>
  </div>
</div>
      </div><!-- /row -->

      <!-- footer -->
      <footer role="contentinfo">
          &copy; Copyright 2015, INRIA.
        Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.3.1.
      </footer>
      <!-- /footer -->

    </div>
    <!-- /container -->

  </body>
</html>